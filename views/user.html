{% extends "navbar.html" %}

{% block body %}
<h2>Devices</h2>

<table id="devices" class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">Name</th>
      <th scope="col">Configuration Link</th>
      <th scope="col">Manage</th>
    </tr>
  </thead>
  <tbody>
    {% set urlRegExp = r/^owntracks:\/\/[^\/]/ %}
    {% for device in userData.devices %}
    <tr>
      <th scope="row">{{ device.name }}</th>
      <th scope="row"><a class="btn btn-info" href="{{ device.configLink | replace(urlRegExp, 'owntracks:///c') }}" role="button">OwnTracks Link</a></th>
      <td scope="row"><a class="btn btn-secondary" href="/user/edit-device/{{ device.name }}" role="button">Edit</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<a class="btn btn-primary" href="/user/add-device" role="button">Add</a>

<h2 class="pt-3">Friends</h2>

<form id="friend-form">
  {% for user in allUsers %}
  {% if user.username != username %}
  <div class="form-check">
    <input class="form-check-input" type="checkbox" value="{{ user.username }}" id="{{ user.username }}-check" name="friends"{% if userData.friends.includes(user.username) %} checked{% endif %}>
    <label class="form-check-label" for="{{ user.username }}-check">
      {{ user.username }}
    </label>
  </div>
  {% endif %}
  {% endfor %}

  <button id="friend-save" class="btn btn-primary" type="submit">Save Friends</button>
</form>

<h2 class="pt-3">Groups (not ready yet)</h2>

<table id="groups" class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">Name</th>
      <th scope="col">Members</th>
      <th scope="col">Manage</th>
    </tr>
  </thead>
  <tbody>
    {% for group in allGroups %}
    <tr>
      <th scope="row">{{ group.name }}</th>
      <td>{{ group.members | join(", ") }}</td>
      <td>{{ user.friends.length }}</td>
      <td>{{ user.groups.length }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block scripts %}<script src="javascripts/user.js"></script>{% endblock %}
