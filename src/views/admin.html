{% extends "navbar.html" %}

{% block body %}
<h2>Registration Links</h2>
<form id="generate-registration">
  <div class="row">
    <div class="col-4">
      <input type="url" id="registration-url"  value="" readonly="readonly">
      <div class="valid-feedback">
        Copied to clipboard!
      </div>
    </div>
    <div class="col-2">
      <button type="submit" class="btn btn-primary">Generate</button>
    </div>
  </div>
</form>
<table id="registration-table" class="table table-striped table-hover table-responsive align-middle">
  <thead>
    <tr>
      <th scope="col">URL</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    {% for registration in allRegistrations %}
    <tr>
      <th scope="row">{{ baseUrl }}/register/{{ registration.guid }}</th>
      <td><a class="btn btn-primary" href="/admin/revoke-registration/{{ registration.guid }}" role="button">Revoke</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<h2>Users</h2>
<table id="user-table" class="table table-striped table-hover table-responsive align-middle">
  <thead>
    <tr>
      <th scope="col">Username</th>
      <th scope="col">Devices</th>
      <th scope="col">Friends</th>
      <th scope="col">Groups</th>
      <th scope="col">Manage</th>
    </tr>
  </thead>
  <tbody>
    {% for user in allUsers %}
    <tr>
      <th scope="row">{{ user.username }}</th>
      <td>{{ allDevices | arrayFilter('userId', user._id) | length }}</td>
      <td>{{ user.friends.length }}</td>
      <td>{{ allGroups | arrayFilterPropIncludes('members', 'userId', user._id) | length }}</td>
      <td>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="{{ user._id }}-admin-switch" value="{{ user._id }}"{% if user.isAdmin %} checked{% endif %}>
          <label class="form-check-label" for="{{ user._id }}-admin-switch">Admin</label>
        </div>
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-modal" data-bs-userId="{{ user._id }}">Delete</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Delete Modal -->
<div class="modal fade" id="delete-modal" tabindex="-1" aria-labelledby="delete-modal-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="delete-modal-label">Delete User Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        This is a real delete, not like a Facebook delete. This action can't be undone!
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <a id="delete-modal-button" class="btn btn-danger" href="#" role="button">Delete</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}<script src="javascripts/admin.js"></script>{% endblock %}
